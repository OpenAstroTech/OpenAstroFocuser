/*
 * Copyright (c) 2025 Zephyr Project Members
 * SPDX-License-Identifier: Apache-2.0
 */

/* Devicetree overlay enabling the Moonlite focuser firmware on ESP32-S3 DevKitC
 * (PROCPU). The dedicated stepper controller is described as a Zephyr
 * gpio-step-dir device and exposed via the "stepper" alias, while the discrete
 * TMC2209 driver ("stepper-drv" alias) manages the enable signal through the
 * Zephyr stepper driver API. The zephyr,user node supplies the UART phandle
 * consumed by the application.
 */

/ {
	aliases {
		stepper = &focuser_stepper;
		stepper-drv = &focuser_stepper_driver;
	};

	focuser_stepper_driver: focuser_stepper_driver {
		compatible = "adi,tmc2209";
		en-gpios = <&gpio0 15 GPIO_ACTIVE_LOW>;
		micro-step-res = <1>;
		status = "okay";
	};

	focuser_stepper: focuser_stepper {
		compatible = "zephyr,gpio-step-dir-controller";
		step-gpios = <&gpio0 16 GPIO_ACTIVE_HIGH>;
		dir-gpios = <&gpio0 17 GPIO_ACTIVE_HIGH>;
		step-width-ns = <10000>;
		status = "okay";
	};

	zephyr,user {
		uart_handler = <&uart1>;
	};
};

&uart0 {
	current-speed = <9600>;
};

&uart1 {
	status = "okay";
	current-speed = <9600>;
	pinctrl-0 = <&moonlite_uart1_default>;
	pinctrl-names = "default";
};

&pinctrl {
	moonlite_uart1_default: moonlite_uart1_default {
		group1 {
			pinmux = <UART1_TX_GPIO8>;
		};

		group2 {
			pinmux = <UART1_RX_GPIO9>;
			bias-pull-up;
		};
	};
};
